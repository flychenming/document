## 优雅地关闭k8s中的pod

docker容器任何时候都能被终止。如在弹性收缩，部署删除或者滚动发布的时候。在大部分的情况下，你可能希望优雅的关闭你在容器中运行的项目。

在我们的案例中，我们希望当前所有的请求（或者后台运行的任务）完成后终止我们的容器。但是优雅关闭应用程序的实际原因可能有很多，包括释放资源，分布式锁或打开的连接。

## 它是如何工作的

当一个pod将要被关闭：

1. SIGTERM信号会被发送到每一个容器的主进程（pid为1的那个）。优雅停机就从此时开始读秒（默认30秒，下文中可以看到如何修改它）。
1. 在SIGTERM接收后，每一个容器中正在运行的程序将会启动优雅关闭并退出。
1. 如果一个容器在优雅时间片段内并没有终止，系统会发送SIGKILL强行终止容器。
